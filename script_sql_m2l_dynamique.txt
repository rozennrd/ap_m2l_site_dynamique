DROP DATABASE IF EXISTS M2LDYNAMIQUE

CREATE DATABASE IF NOT EXISTS M2LDYNAMIQUE
ENGINE="INNODB";
USE M2LDYNAMIQUE;
# -----------------------------------------------------------------------------
#       TABLE : LIGUE
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS LIGUE
 (
   idLigue CHAR(32) NOT NULL  ,
   nomLigue CHAR(32) NULL  ,
   site CHAR(32) NULL  ,
   descriptif CHAR(32) NULL  
   , PRIMARY KEY (idLigue) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       TABLE : FONCTION
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS FONCTION
 (
   idFonc CHAR(32) NOT NULL  ,
   libelle CHAR(32) NULL  
   , PRIMARY KEY (idFonc) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       TABLE : UTILISATEUR
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS UTILISATEUR
 (
   idUser CHAR(32) NOT NULL  ,
   idLigue CHAR(32) NULL  ,
   idFonc CHAR(32) NOT NULL  ,
   idClub CHAR(32) NULL  ,
   nom CHAR(32) NULL  ,
   prenom CHAR(32) NULL  ,
   login CHAR(32) NULL  ,
   mdp CHAR(32) NULL  ,
   statut CHAR(32) NULL  ,
   typeUser CHAR(32) NULL  
   , PRIMARY KEY (idUser) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE UTILISATEUR
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_UTILISATEUR_LIGUE
     ON UTILISATEUR (idLigue ASC);

CREATE  INDEX I_FK_UTILISATEUR_FONCTION
     ON UTILISATEUR (idFonc ASC);

CREATE  INDEX I_FK_UTILISATEUR_CLUB
     ON UTILISATEUR (idClub ASC);

# -----------------------------------------------------------------------------
#       TABLE : DEPARTEMENT
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS DEPARTEMENT
 (
   codeDep CHAR(32) NOT NULL  ,
   nomDep CHAR(32) NULL  
   , PRIMARY KEY (codeDep) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       TABLE : BULLETIN
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS BULLETIN
 (
   idBulletin CHAR(32) NOT NULL  ,
   idContrat CHAR(32) NOT NULL  ,
   mois CHAR(32) NULL  ,
   annee CHAR(32) NULL  ,
   bulletinPdf CHAR(32) NULL  
   , PRIMARY KEY (idBulletin) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE BULLETIN
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_BULLETIN_CONTRAT
     ON BULLETIN (idContrat ASC);

# -----------------------------------------------------------------------------
#       TABLE : FORMATION
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS FORMATION
 (
   idForma CHAR(32) NOT NULL  ,
   intitule CHAR(32) NULL  ,
   descriptif CHAR(32) NULL  ,
   duree CHAR(32) NULL  ,
   dateOuvertureInscription CHAR(32) NULL  ,
   dateClotureInscription CHAR(32) NULL  ,
   effectifMax CHAR(32) NULL  
   , PRIMARY KEY (idForma) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       TABLE : CONTRAT
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS CONTRAT
 (
   idContrat CHAR(32) NOT NULL  ,
   idUser CHAR(32) NOT NULL  ,
   dateDebut CHAR(32) NULL  ,
   dateFin CHAR(32) NULL  ,
   typeContrat CHAR(32) NULL  ,
   nbHeures CHAR(32) NULL  
   , PRIMARY KEY (idContrat) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE CONTRAT
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_CONTRAT_UTILISATEUR
     ON CONTRAT (idUser ASC);

# -----------------------------------------------------------------------------
#       TABLE : CODEPOS
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS CODEPOS
 (
   codePos CHAR(32) NOT NULL  
   , PRIMARY KEY (codePos) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       TABLE : CLUB
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS CLUB
 (
   idClub CHAR(32) NOT NULL  ,
   idLigue CHAR(32) NOT NULL  ,
   idVille CHAR(32) NOT NULL  ,
   nomClub CHAR(32) NULL  ,
   adresseClub CHAR(32) NULL  
   , PRIMARY KEY (idClub) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE CLUB
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_CLUB_LIGUE
     ON CLUB (idLigue ASC);

CREATE  INDEX I_FK_CLUB_VILLES
     ON CLUB (idVille ASC);

# -----------------------------------------------------------------------------
#       TABLE : VILLES
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS VILLES
 (
   idVille CHAR(32) NOT NULL  ,
   codeDep CHAR(32) NOT NULL  ,
   nomVille CHAR(32) NULL  
   , PRIMARY KEY (idVille) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE VILLES
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_VILLES_DEPARTEMENT
     ON VILLES (codeDep ASC);

# -----------------------------------------------------------------------------
#       TABLE : DEMANDEINSCRIPTION
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS DEMANDEINSCRIPTION
 (
   idUser CHAR(32) NOT NULL  ,
   idForma CHAR(32) NOT NULL  ,
   statutDemande CHAR(32) NULL  
   , PRIMARY KEY (idUser,IDFORMA) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE DEMANDEINSCRIPTION
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_DEMANDEINSCRIPTION_UTILISATEUR
     ON DEMANDEINSCRIPTION (idUser ASC);

CREATE  INDEX I_FK_DEMANDEINSCRIPTION_FORMATION
     ON DEMANDEINSCRIPTION (idForma ASC);

# -----------------------------------------------------------------------------
#       TABLE : CORRESPOND
# -----------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS CORRESPOND
 (
   codePos CHAR(32) NOT NULL  ,
   idVille CHAR(32) NOT NULL  
   , PRIMARY KEY (codePos,idVille) 
 ) 
 comment = "";

# -----------------------------------------------------------------------------
#       INDEX DE LA TABLE CORRESPOND
# -----------------------------------------------------------------------------


CREATE  INDEX I_FK_CORRESPOND_CODEPOS
     ON CORRESPOND (codePos ASC);

CREATE  INDEX I_FK_CORRESPOND_VILLES
     ON CORRESPOND (idVille ASC);


# -----------------------------------------------------------------------------
#       CREATION DES REFERENCES DE TABLE
# -----------------------------------------------------------------------------


ALTER TABLE UTILISATEUR 
  ADD FOREIGN KEY FK_UTILISATEUR_LIGUE (idLigue)
      REFERENCES LIGUE (idLigue) ;


ALTER TABLE UTILISATEUR 
  ADD FOREIGN KEY FK_UTILISATEUR_FONCTION (idFonc)
      REFERENCES FONCTION (idFonc) ;


ALTER TABLE UTILISATEUR 
  ADD FOREIGN KEY FK_UTILISATEUR_CLUB (idClub)
      REFERENCES CLUB (idClub) ;


ALTER TABLE BULLETIN 
  ADD FOREIGN KEY FK_BULLETIN_CONTRAT (IDCONTRAT)
      REFERENCES CONTRAT (IDCONTRAT) ;


ALTER TABLE CONTRAT 
  ADD FOREIGN KEY FK_CONTRAT_UTILISATEUR (idUser)
      REFERENCES UTILISATEUR (idUser) ;


ALTER TABLE CLUB 
  ADD FOREIGN KEY FK_CLUB_LIGUE (idLigue)
      REFERENCES LIGUE (idLigue) ;


ALTER TABLE CLUB 
  ADD FOREIGN KEY FK_CLUB_VILLES (idVille)
      REFERENCES VILLES (idVille) ;


ALTER TABLE VILLES 
  ADD FOREIGN KEY FK_VILLES_DEPARTEMENT (codeDep)
      REFERENCES DEPARTEMENT (codeDep) ;


ALTER TABLE DEMANDEINSCRIPTION 
  ADD FOREIGN KEY FK_DEMANDEINSCRIPTION_UTILISATEUR (idUser)
      REFERENCES UTILISATEUR (idUser) ;


ALTER TABLE DEMANDEINSCRIPTION 
  ADD FOREIGN KEY FK_DEMANDEINSCRIPTION_FORMATION (idForma)
      REFERENCES FORMATION (idForma) ;


ALTER TABLE CORRESPOND 
  ADD FOREIGN KEY FK_CORRESPOND_CODEPOS (codePos)
      REFERENCES CODEPOS (codePos) ;


ALTER TABLE CORRESPOND 
  ADD FOREIGN KEY FK_CORRESPOND_VILLES (idVille)
      REFERENCES VILLES (idVille) ;

